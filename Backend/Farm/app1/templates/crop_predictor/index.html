<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farmer's Market Analysis App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            color: green;
        }
    </style>
</head>
<body>
    <h1>Farmer's Market Analysis App</h1>
    <form id="crop-form">
        <label for="crop">Enter the crop name:</label>
        <input type="text" id="crop" name="crop" required>
        <button type="submit">Get Prices</button>
    </form>
    <div id="results"></div>
    <script>
        document.getElementById("crop-form").addEventListener("submit", async function(event) {
            event.preventDefault();
            const crop = document.getElementById("crop").value;
            console.log("Submitting crop:", crop);  // Add this line to check the form data
            const response = await fetch("/prices/" + crop + "/", {
                method: "GET",
                headers: { 
                    "Content-Type": "application/json",
                },
            });
            const data = await response.json();
            console.log("Received data:", data);  // Add this line to check the received data
            const resultsDiv = document.getElementById("results");
            resultsDiv.innerHTML = "";

            if (data.error) {
                resultsDiv.textContent = data.error;
            } else {
                const prices = data.prices;
                const predictions = data.predictions;

                const priceList = document.createElement("ul");
                priceList.innerHTML = `<h2>Current Prices:</h2>`;
                for (const [state, price] of Object.entries(prices)) {
                    const li = document.createElement("li");
                    li.textContent = `${state}: ${price.toFixed(2)} per quintal`;
                    priceList.appendChild(li);
                }
                resultsDiv.appendChild(priceList);

                const predictionList = document.createElement("ul");
                predictionList.innerHTML = `<h2>Predicted Prices for the Next 7 Days:</h2>`;
                for (const [state, forecast] of Object.entries(predictions)) {
                    const stateDiv = document.createElement("div");
                    stateDiv.innerHTML = `<h3>${state}</h3>`;
                    const forecastUl = document.createElement("ul");
                    forecast.forEach(([date, price]) => {
                        const li = document.createElement("li");
                        li.textContent = `${date}: ${price.toFixed(2)} per quintal`;
                        forecastUl.appendChild(li);
                    });
                    stateDiv.appendChild(forecastUl);
                    predictionList.appendChild(stateDiv);
                }
                resultsDiv.appendChild(predictionList);
            }
        });
    </script>
</body>
</html>